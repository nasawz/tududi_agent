# Tududi API - 当前用户状态相关接口清单

基于对 Tududi API 文档的分析，以下是所有与当前用户状态相关的接口列表。

## 📋 接口总览

### 🔐 **身份验证与用户信息**

| 接口名称 | 方法 | 路径 | 功能描述 | 认证状态 |
|---------|------|------|----------|----------|
| 获取应用版本 | GET | `/api/auth/version` | 获取 Tududi 版本号 | ✅ 无需认证 |
| 获取当前用户 | GET | `/api/auth/current_user` | 获取当前登录用户基本信息 | ✅ 需要登录 |
| **获取用户资料** | GET | `/api/profile` | **获取当前用户完整资料和设置** | ✅ 需要登录 |

---

### 📝 **任务相关接口**

| 接口名称 | 方法 | 路径 | 功能描述 |
|---------|------|------|----------|
| 获取任务列表 | GET | `/api/tasks` | 获取当前用户任务（支持 type=today/upcoming/someday） |
| 获取单个任务 | GET | `/api/task/{uid}` | 根据 UID 获取任务详情 |
| 创建任务 | POST | `/api/task` | 创建新任务 |
| 更新任务 | PATCH | `/api/task/{uid}` | 更新任务信息 |
| 删除任务 | DELETE | `/api/task/{uid}` | 删除任务 |
| 获取任务时间线 | GET | `/api/task/{uid}/timeline` | 获取任务操作历史 |
| 获取完成时间分析 | GET | `/api/task/{uid}/completion-time` | 分析任务完成时间 |
| 获取生产力指标 | GET | `/api/task/productivity-metrics` | 获取用户生产力统计 |

---

### 📁 **项目相关接口**

| 接口名称 | 方法 | 路径 | 功能描述 |
|---------|------|------|----------|
| 获取项目列表 | GET | `/api/projects` | 获取当前用户的所有项目 |
| 获取单个项目 | GET | `/api/project/{uid}` | 根据 UID 获取项目详情 |
| 创建项目 | POST | `/api/project` | 创建新项目 |
| 更新项目 | PATCH | `/api/project/{uid}` | 更新项目信息 |
| 删除项目 | DELETE | `/api/project/{uid}` | 删除项目 |
| 上传项目图片 | POST | `/api/upload/project-image` | 上传项目图片 |

---

### 🗂️ **区域相关接口**

| 接口名称 | 方法 | 路径 | 功能描述 |
|---------|------|------|----------|
| 获取所有区域 | GET | `/api/areas` | 获取当前用户的项目分类区域 |
| 获取单个区域 | GET | `/api/areas/{uid}` | 根据 UID 获取区域详情 |
| 创建区域 | POST | `/api/area` | 创建新区域 |
| 更新区域 | PATCH | `/api/area/{uid}` | 更新区域信息 |
| 删除区域 | DELETE | `/api/area/{uid}` | 删除区域 |

---

### 🏷️ **标签相关接口**

| 接口名称 | 方法 | 路径 | 功能描述 |
|---------|------|------|----------|
| 获取所有标签 | GET | `/api/tags` | 获取当前用户的所有标签 |
| 获取单个标签 | GET | `/api/tag?uid={uid}` 或 `/api/tag?name={name}` | 根据 UID 或名称获取标签 |
| 创建标签 | POST | `/api/tag` | 创建新标签 |
| 更新标签 | PATCH | `/api/tag/{uid}` | 更新标签信息 |
| 删除标签 | DELETE | `/api/tag/{uid}` | 删除标签 |

---

### 📓 **笔记相关接口**

| 接口名称 | 方法 | 路径 | 功能描述 |
|---------|------|------|----------|
| 获取笔记列表 | GET | `/api/notes` | 获取当前用户的笔记 |
| 获取单个笔记 | GET | `/api/note/{uid}` | 根据 UID 获取笔记详情 |
| 创建笔记 | POST | `/api/note` | 创建新笔记 |
| 更新笔记 | PATCH | `/api/note/{uid}` | 更新笔记信息 |
| 删除笔记 | DELETE | `/api/note/{uid}` | 删除笔记 |

---

### 📥 **收件箱相关接口**

| 接口名称 | 方法 | 路径 | 功能描述 |
|---------|------|------|----------|
| 获取收件箱列表 | GET | `/api/inbox` | 获取用户的快速收集列表 |
| 添加收件箱项目 | POST | `/api/inbox` | 添加新项目到收件箱 |
| 处理收件箱项目 | POST | `/api/inbox/{uid}/process` | 处理收件箱项目 |
| 删除收件箱项目 | DELETE | `/api/inbox/{uid}` | 删除收件箱项目 |

---

### 👥 **共享相关接口**

| 接口名称 | 方法 | 路径 | 功能描述 |
|---------|------|------|----------|
| 获取我的共享 | GET | `/api/shares/mine` | 获取与当前用户共享的资源 |
| 创建共享 | POST | `/api/shares` | 共享资源给其他用户 |
| 撤销共享 | DELETE | `/api/shares` | 撤销共享权限 |

---

### 👁️ **视图相关接口**

| 接口名称 | 方法 | 路径 | 功能描述 |
|---------|------|------|----------|
| 获取所有视图 | GET | `/api/views` | 获取用户自定义视图列表 |
| 获取单个视图 | GET | `/api/view/{uid}` | 根据 UID 获取视图详情 |
| 创建视图 | POST | `/api/view` | 创建新视图 |
| 更新视图 | PATCH | `/api/view/{uid}` | 更新视图信息 |
| 删除视图 | DELETE | `/api/view/{uid}` | 删除视图 |

---

### 🔍 **搜索相关接口**

| 接口名称 | 方法 | 路径 | 功能描述 |
|---------|------|------|----------|
| 通用搜索 | GET | `/api/search` | 跨实体搜索当前用户数据 |

---

### 🤖 **Telegram 相关接口**

| 接口名称 | 方法 | 路径 | 功能描述 |
|---------|------|------|----------|
| 启动 Telegram 轮询 | POST | `/api/telegram/start` | 启动 Telegram 机器人轮询 |
| 停止 Telegram 轮询 | POST | `/api/telegram/stop` | 停止 Telegram 机器人轮询 |
| 发送任务摘要 | POST | `/api/telegram/send-summary` | 立即发送任务摘要 |

---

### 💬 **其他功能接口**

| 接口名称 | 方法 | 路径 | 功能描述 | 认证要求 |
|---------|------|------|----------|----------|
| 获取随机名言 | GET | `/api/quotes/random` | 获取励志名言 | ❌ 无需认证 |
| 获取所有名言 | GET | `/api/quotes` | 获取名言列表 | ❌ 无需认证 |
| URL 预览 | POST | `/api/url/preview` | 获取 URL 页面预览信息 | ✅ 需要登录 |

---

## 📊 **当前用户状态总结**

基于已测试的 `GET /api/profile` 接口，当前用户状态信息：

### 🔑 **基本信息**
- **用户 ID**: `q7mq9kiuvmt8gmy`
- **邮箱**: `nasa127@gmail.com`
- **界面主题**: `light`
- **语言**: `en`
- **时区**: `UTC`
- **一周第一天**: `1` (周一)

### ⚙️ **功能状态**
| 功能 | 状态 | 说明 |
|------|------|------|
| 登录状态 | ✅ 已登录 | 会话有效，Cookie 可用 |
| Telegram 集成 | ❌ 未配置 | Bot Token、Chat ID 未设置 |
| 任务摘要 | ❌ 未启用 | `task_summary_enabled: false` |
| 任务智能 | ✅ 已启用 | `task_intelligence_enabled: true` |
| 番茄钟 | ✅ 已启用 | `pomodoro_enabled: true` |
| 生产力助手 | ✅ 已启用 | `productivity_assistant_enabled: true` |
| 下一任务建议 | ✅ 已启用 | `next_task_suggestion_enabled: true` |

### 📱 **今日页面设置**
```json
{
  "showMetrics": false,
  "showProductivity": false,
  "showNextTaskSuggestion": false,
  "showSuggestions": false,
  "showDueToday": true,
  "showCompleted": true,
  "showProgressBar": true,
  "showDailyQuote": true
}
```

---

## 🎯 **推荐优先测试的接口**

基于当前用户状态，建议优先测试以下接口：

### 1️⃣ **身份验证类**
- `GET /api/auth/current_user` - 验证当前登录状态
- `GET /api/auth/version` - 获取应用版本

### 2️⃣ **数据获取类**
- `GET /api/tasks?type=today` - 获取今日任务
- `GET /api/projects` - 查看当前项目
- `GET /api/areas` - 查看项目分类区域
- `GET /api/inbox` - 查看收件箱内容
- `GET /api/tags` - 查看所有标签

### 3️⃣ **设置类**
- `GET /api/views` - 查看自定义视图
- `GET /api/notes` - 查看笔记列表

### 4️⃣ **搜索类**
- `GET /api/search` - 测试搜索功能

---

## 📝 **测试注意事项**

1. **SSL 证书问题**: 测试环境使用自签名证书，需要在请求中配置 `rejectUnauthorized: false`

2. **会话认证**: 大部分接口需要有效的登录会话，Cookie 信息来自 `/mark.txt`

3. **权限控制**: 某些接口可能需要特定的访问权限（ro/rw）

4. **分页支持**: 列表类接口支持 `limit`、`offset` 等分页参数

5. **排序和过滤**: 大部分列表接口支持 `orderBy`、`filter` 等查询参数

---

## 🔧 **测试脚本示例**

### 使用 axios 测试（推荐）

```javascript
const axios = require('axios');
const https = require('https');

// 创建 HTTPS 代理
const httpsAgent = new https.Agent({
  rejectUnauthorized: false
});

// 测试接口
const response = await axios.get(`${BASE_URL}/api/tasks`, {
  httpsAgent,
  headers: {
    'Cookie': COOKIE
  },
  withCredentials: true,
  timeout: 15000
});
```

---

## 📄 **文档信息**

- **生成时间**: 2025-11-05
- **API 版本**: v0.86-beta.1
- **文档来源**: `/Users/wangzhe/work/server/tududi_agent/doc/api/`
- **测试环境**: `https://competent_shaw.orb.local`

---

## 📚 **相关文档**

- [身份验证 API](./doc/api/auth.md)
- [用户管理 API](./doc/api/users.md)
- [任务管理 API](./doc/api/tasks.md)
- [项目管理 API](./doc/api/projects.md)
- [API 概览](./doc/api/README.md)

---

> **注意**: 本清单基于 Tududi API 文档整理，具体接口行为和参数请参考对应的 API 文档文件。
