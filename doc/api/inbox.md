# 收件箱API文档

## 概述
收件箱API提供快速收集和处理任务想法的功能。用户可以快速将想法、任务或笔记添加到收件箱，然后稍后处理它们。

## 基础路径
```
/api/inbox
```

## 认证方式
- 需要有效的登录会话
- 所有操作仅限当前用户自己的数据

## 数据模型

### InboxItem（收件箱项目）
| 字段 | 类型 | 说明 |
|------|------|------|
| uid | string | 项目唯一标识符 |
| content | string | 项目内容 |
| status | string | 项目状态 |
| source | string | 来源（manual/telegram/other） |
| user_id | number | 所属用户ID |
| created_at | string | 创建时间 |
| updated_at | string | 更新时间 |

### 项目状态
- **added**：已添加（初始状态）
- **processed**：已处理
- **deleted**：已删除（软删除）

## 接口列表

### 1. 获取收件箱列表

#### 请求
```http
GET /api/inbox
```

#### 查询参数（分页）
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| limit | number | 否 | 返回数量限制（默认20） |
| offset | number | 否 | 偏移量（默认0） |

#### 响应（带分页）
**成功 (200)**
```json
{
  "items": [
    {
      "uid": "inbox_abc123",
      "content": "需要购买办公用品",
      "status": "added",
      "source": "manual",
      "created_at": "2024-01-01T10:00:00.000Z",
      "updated_at": "2024-01-01T10:00:00.000Z"
    },
    {
      "uid": "inbox_def456",
      "content": "联系客户确认需求",
      "status": "added",
      "source": "telegram",
      "created_at": "2024-01-01T11:00:00.000Z",
      "updated_at": "2024-01-01T11:00:00.000Z"
    }
  ],
  "pagination": {
    "total": 50,
    "limit": 20,
    "offset": 0,
    "hasMore": true
  }
}
```

#### 响应（简单列表）
**成功 (200)**
```json
[
  {
    "uid": "inbox_abc123",
    "content": "需要购买办公用品",
    "status": "added",
    "source": "manual",
    "created_at": "2024-01-01T10:00:00.000Z",
    "updated_at": "2024-01-01T10:00:00.000Z"
  }
]
```

#### 响应字段说明
| 字段 | 类型 | 说明 |
|------|------|------|
| items | array | 收件箱项目列表 |
| pagination | object | 分页信息（仅分页模式返回） |
| items[].uid | string | 项目UID |
| items[].content | string | 项目内容 |
| items[].status | string | 项目状态 |
| items[].source | string | 来源 |
| items[].created_at | string | 创建时间 |
| items[].updated_at | string | 更新时间 |
| pagination.total | number | 总项目数 |
| pagination.limit | number | 每页数量 |
| pagination.offset | 偏移量 | 偏移量 |
| pagination.hasMore | boolean | 是否还有更多 |

#### 错误响应
| 状态码 | 说明 |
|--------|------|
| 500 | 服务器内部错误 |

---

### 2. 添加收件箱项目

#### 请求
```http
POST /api/inbox
```

#### 请求体
```json
{
  "content": "新任务想法：优化网站性能",
  "source": "manual"
}
```

#### 参数说明
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| content | string | 是 | 项目内容 |
| source | string | 否 | 来源（默认manual） |

#### 来源类型
- **manual**：手动添加
- **telegram**：来自Telegram Bot
- **api**：通过API添加
- **import**：导入的数据

#### 响应
**成功 (201)**
```json
{
  "uid": "inbox_new123",
  "content": "新任务想法：优化网站性能",
  "status": "added",
  "source": "manual",
  "created_at": "2024-01-15T10:00:00.000Z",
  "updated_at": "2024-01-15T10:00:00.000Z"
}
```

#### 错误响应
| 状态码 | 说明 |
|--------|------|
| 400 | 内容为空或缺失必填参数 |
| 400 | 创建失败，包含详细错误信息 |
| 500 | 服务器内部错误 |

---

### 3. 获取单个收件箱项目

#### 请求
```http
GET /api/inbox/inbox_abc123
```

#### 路径参数
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| uid | string | 是 | 收件箱项目UID |

#### 响应
**成功 (200)**
```json
{
  "uid": "inbox_abc123",
  "content": "需要购买办公用品",
  "status": "added",
  "source": "manual",
  "created_at": "2024-01-01T10:00:00.000Z",
  "updated_at": "2024-01-01T10:00:00.000Z"
}
```

#### 错误响应
| 状态码 | 说明 |
|--------|------|
| 400 | 无效的UID格式 |
| 404 | 项目不存在 |
| 500 | 服务器内部错误 |

---

### 4. 更新收件箱项目

#### 请求
```http
PATCH /api/inbox/inbox_abc123
```

#### 路径参数
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| uid | string | 是 | 收件箱项目UID |

#### 请求体
```json
{
  "content": "更新后的内容：需要购买办公用品和打印纸",
  "status": "processed"
}
```

#### 参数说明
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| content | string | 否 | 项目内容 |
| status | string | 否 | 项目状态 |

#### 响应
**成功 (200)**
```json
{
  "uid": "inbox_abc123",
  "content": "更新后的内容：需要购买办公用品和打印纸",
  "status": "processed",
  "source": "manual",
  "created_at": "2024-01-01T10:00:00.000Z",
  "updated_at": "2024-01-15T12:00:00.000Z"
}
```

#### 错误响应
| 状态码 | 说明 |
|--------|------|
| 400 | 无效的UID格式 |
| 404 | 项目不存在 |
| 400 | 更新失败，包含详细错误信息 |
| 500 | 服务器内部错误 |

---

### 5. 删除收件箱项目

#### 请求
```http
DELETE /api/inbox/inbox_abc123
```

#### 路径参数
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| uid | string | 是 | 收件箱项目UID |

#### 响应
**成功 (200)**
```json
{
  "message": "Inbox item successfully deleted"
}
```

#### 错误响应
| 状态码 | 说明 |
|--------|------|
| 400 | 无效的UID格式 |
| 404 | 项目不存在 |
| 400 | 删除失败 |
| 500 | 服务器内部错误 |

**注意**：删除是软删除，状态会设置为"deleted"而不是物理删除。

---

### 6. 标记为已处理

#### 请求
```http
PATCH /api/inbox/inbox_abc123/process
```

#### 路径参数
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| uid | string | 是 | 收件箱项目UID |

#### 响应
**成功 (200)**
```json
{
  "uid": "inbox_abc123",
  "content": "需要购买办公用品",
  "status": "processed",
  "source": "manual",
  "created_at": "2024-01-01T10:00:00.000Z",
  "updated_at": "2024-01-15T12:00:00.000Z"
}
```

#### 错误响应
| 状态码 | 说明 |
|--------|------|
| 400 | 无效的UID格式 |
| 404 | 项目不存在 |
| 400 | 处理失败 |
| 500 | 服务器内部错误 |

---

### 7. 文本智能分析

#### 请求
```http
POST /api/inbox/analyze-text
```

#### 请求体
```json
{
  "content": "明天上午10点开会讨论项目进度"
}
```

#### 参数说明
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| content | string | 是 | 要分析的文本内容 |

#### 功能说明
该接口使用智能分析服务（`processInboxItem`）来分析文本内容，自动提取：
- 任务名称
- 截止日期
- 优先级
- 标签
- 项目信息

#### 响应
**成功 (200)**
```json
{
  "extracted_info": {
    "task_name": "讨论项目进度",
    "due_date": "2024-01-02T10:00:00.000Z",
    "priority": 1,
    "tags": ["会议", "项目"],
    "project": null
  },
  "confidence": 0.85,
  "suggestions": [
    "检测到时间信息：明天上午10点",
    "建议添加项目标签"
  ]
}
```

#### 实际响应格式
实际响应格式取决于`processInboxItem`服务的实现，可能返回：
- 任务名称建议
- 提取的日期时间
- 优先级评分
- 相关标签
- 项目建议

#### 错误响应
| 状态码 | 说明 |
|--------|------|
| 400 | 内容为空或不是字符串 |
| 500 | 服务器内部错误 |

## 使用场景

### 快速收集
1. **随时记录**：
   - 在任何时候想到任务或想法，立即添加到收件箱
   - 不会打断当前的工作流程

2. **来源多样化**：
   - 手动添加
   - 通过Telegram Bot添加
   - 通过API批量导入

### 批量处理
1. **定期清空**：
   - 每天或每周查看收件箱
   - 将项目分类到任务或笔记
   - 标记为已处理

2. **智能处理**：
   - 使用文本分析功能
   - 自动提取关键信息
   - 提高处理效率

### 工作流程
```
想法产生 → 添加到收件箱 → 定期查看 → 分类处理 → 标记完成
```

## 分页说明

### 分页模式
当提供`limit`或`offset`参数时，返回分页格式：
- 包含分页信息
- 适合处理大量数据
- 支持前端懒加载

### 简单模式
不提供分页参数时，返回简单数组：
- 向后兼容
- 适合小量数据
- 性能更高

## 性能优化

### 索引
收件箱表通常在以下字段上建立索引：
- user_id（用户过滤）
- status（状态过滤）
- created_at（排序）

### 查询优化
- 使用LIMIT限制返回数量
- 使用OFFSET进行分页
- 状态过滤只返回"added"状态的项目

## 最佳实践

### 内容规范
1. **简洁明了**：
   - 使用简短的描述
   - 避免过长的文本

2. **可识别**：
   - 添加上下文信息
   - 使用关键词

### 定期处理
1. **设定频率**：
   - 每天处理收件箱
   - 避免项目堆积

2. **分类标准**：
   - 立即可执行的任务
   - 需要进一步思考的想法
   - 可忽略的信息

## 相关端点

- **任务**：`/api/tasks/*` - 从收件箱创建任务
- **笔记**：`/api/notes/*` - 从收件箱创建笔记
- **文本分析**：`processInboxItem`服务
- **Telegram Bot**：`/api/telegram/*` - 通过Bot添加

## 注意事项

1. **软删除**：删除的项目标记为"deleted"而非物理删除
2. **来源跟踪**：保留项目来源信息，便于追踪
3. **智能分析**：文本分析功能依赖AI服务，可能有延迟
4. **数据隔离**：用户只能访问自己的收件箱项目
5. **并发控制**：多个用户同时操作不会相互影响
