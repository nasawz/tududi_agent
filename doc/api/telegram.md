# Telegramé›†æˆAPIæ–‡æ¡£

## æ¦‚è¿°
Telegramé›†æˆAPIæä¾›ä¸Telegram Botçš„äº¤äº’åŠŸèƒ½ï¼ŒåŒ…æ‹¬Boté…ç½®ã€è½®è¯¢æ§åˆ¶ã€æ¶ˆæ¯å‘é€ç­‰ã€‚ä½¿ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡Telegramæ¥æ”¶ä»»åŠ¡æ‘˜è¦ã€åˆ›å»ºæ”¶ä»¶ç®±é¡¹ç›®å’Œç®¡ç†ä»»åŠ¡ã€‚

## åŸºç¡€è·¯å¾„
```
/api/telegram
```

## è®¤è¯æ–¹å¼
- éœ€è¦æœ‰æ•ˆçš„ç™»å½•ä¼šè¯
- æ‰€æœ‰æ“ä½œä»…é™å½“å‰ç”¨æˆ·è‡ªå·±çš„è®¾ç½®

## å‰ææ¡ä»¶
ç”¨æˆ·éœ€è¦å…ˆåœ¨ç”¨æˆ·èµ„æ–™ä¸­é…ç½®Telegram Bot Tokenï¼ˆé€šè¿‡`/api/users/profile`æ¥å£ï¼‰ã€‚

## æ¥å£åˆ—è¡¨

### 1. å¯åŠ¨Telegramè½®è¯¢

#### è¯·æ±‚
```http
POST /api/telegram/start-polling
```

#### å“åº”
**æˆåŠŸ (200)**
```json
{
  "success": true,
  "message": "Telegram polling started",
  "status": {
    "active": true,
    "users": [1, 2, 3]
  }
}
```

#### é”™è¯¯å“åº”
| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 400 | æœªè®¾ç½®Telegram Bot Token |
| 500 | å¯åŠ¨å¤±è´¥ |

---

### 2. åœæ­¢Telegramè½®è¯¢

#### è¯·æ±‚
```http
POST /api/telegram/stop-polling
```

#### å“åº”
**æˆåŠŸ (200)**
```json
{
  "success": true,
  "message": "Telegram polling stopped",
  "status": {
    "active": false,
    "users": []
  }
}
```

#### é”™è¯¯å“åº”
| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 500 | åœæ­¢å¤±è´¥ |

---

### 3. è·å–è½®è¯¢çŠ¶æ€

#### è¯·æ±‚
```http
GET /api/telegram/polling-status
```

#### å“åº”
**æˆåŠŸ (200)**
```json
{
  "success": true,
  "status": {
    "active": true,
    "users": [1, 2, 3]
  }
}
```

#### å“åº”å­—æ®µè¯´æ˜
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| status.active | boolean | è½®è¯¢æ˜¯å¦å¯ç”¨ |
| status.users | array | å·²å¯ç”¨è½®è¯¢çš„ç”¨æˆ·IDåˆ—è¡¨ |

#### é”™è¯¯å“åº”
| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

---

### 4. é…ç½®Telegram Bot

#### è¯·æ±‚
```http
POST /api/telegram/setup
```

#### è¯·æ±‚ä½“
```json
{
  "token": "1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"
}
```

#### å‚æ•°è¯´æ˜
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| token | string | æ˜¯ | Telegram Bot Tokenï¼ˆæ ¼å¼ï¼šæ•°å­—:å­—æ¯æ•°å­—ä¸‹åˆ’çº¿çŸ­æ¨ªçº¿ç»„åˆï¼‰ |

#### Tokenæ ¼å¼éªŒè¯
- å¿…é¡»åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ï¼š`^\d+:[A-Za-z0-9_-]{35}$`
- ç¤ºä¾‹ï¼š`1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`

#### å“åº”
**æˆåŠŸ (200)**
```json
{
  "success": true,
  "message": "Telegram bot token updated successfully",
  "bot": {
    "id": 123456789,
    "is_bot": true,
    "first_name": "My Task Bot",
    "username": "mytaskbot"
  }
}
```

#### å“åº”å­—æ®µè¯´æ˜
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| bot.id | number | Botçš„Telegram ID |
| bot.is_bot | boolean | æ ‡è¯†æ˜¯å¦ä¸ºBotï¼ˆæ’ä¸ºtrueï¼‰ |
| bot.first_name | string | Botçš„æ˜¾ç¤ºåç§° |
| bot.username | string | Botçš„ç”¨æˆ·å |

#### é”™è¯¯å“åº”
| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 400 | ç¼ºå°‘tokenæˆ–Tokenæ ¼å¼æ— æ•ˆ |
| 400 | æ— æ•ˆçš„Bot Tokenæˆ–Botä¸å¯è®¿é—® |
| 404 | ç”¨æˆ·ä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

---

### 5. å‘é€æ¬¢è¿æ¶ˆæ¯

#### è¯·æ±‚
```http
POST /api/telegram/send-welcome
```

#### è¯·æ±‚ä½“
```json
{
  "chatId": "123456789"
}
```

#### å‚æ•°è¯´æ˜
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| chatId | string/number | æ˜¯ | Telegram Chat ID |

#### å“åº”
**æˆåŠŸ (200)**
```json
{
  "success": true,
  "message": "Welcome message sent successfully"
}
```

#### é”™è¯¯å“åº”
| çŠ¶æ€ç  | è¯´æ˜ |
|--------|------|
| 400 | æœªè®¾ç½®Telegram Bot Token |
| 400 | ç¼ºå°‘Chat ID |
| 500 | å‘é€å¤±è´¥ |

## Boté›†æˆæµç¨‹

### 1. åˆ›å»ºTelegram Bot
åœ¨Telegramä¸­ä¸ [@BotFather](https://t.me/botfather) å¯¹è¯ï¼š
```
/newbot
é€‰æ‹©åç§°å’Œç”¨æˆ·å
è·å–Bot Token
```

### 2. é…ç½®Bot Token
```http
POST /api/telegram/setup
{
  "token": "ä½ çš„Bot Token"
}
```

### 3. å¯åŠ¨è½®è¯¢
```http
POST /api/telegram/start-polling
```

### 4. å‘Botå‘é€æ¶ˆæ¯
Botä¼šæ¥æ”¶æ¶ˆæ¯å¹¶æ·»åŠ åˆ°æ”¶ä»¶ç®±

## æœºå™¨äººåŠŸèƒ½

### è‡ªåŠ¨åŠŸèƒ½
- **å¿«é€Ÿæ”¶é›†**ï¼šç”¨æˆ·å‘Botå‘é€çš„ä»»ä½•æ¶ˆæ¯éƒ½ä¼šè‡ªåŠ¨æ·»åŠ åˆ°æ”¶ä»¶ç®±
- **ä»»åŠ¡æ‘˜è¦**ï¼šæ ¹æ®ç”¨æˆ·è®¾ç½®çš„è®¡åˆ’å‘é€ä»»åŠ¡æ‘˜è¦
- **å‘½ä»¤æ”¯æŒ**ï¼š
  - `/help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  - ç›´æ¥å‘é€æ–‡æœ¬ - æ·»åŠ åˆ°æ”¶ä»¶ç®±

### æ¬¢è¿æ¶ˆæ¯
ç”¨æˆ·å¯ä»¥å‘ç‰¹å®šChatå‘é€æ¬¢è¿æ¶ˆæ¯ï¼š
```http
POST /api/telegram/send-welcome
{
  "chatId": "ç”¨æˆ·çš„ChatID"
}
```

æ¬¢è¿æ¶ˆæ¯å†…å®¹ï¼š
```
ğŸ‰ Welcome to tududi!

Your personal task management bot is now connected and ready to help!

ğŸ“ Simply send me any message and I'll add it to your tududi inbox as an item.

âœ¨ Commands:
â€¢ /help - Show help information
â€¢ Just type any text - Add it as an inbox item

Let's get organized! ğŸš€
```

## è½®è¯¢æœºåˆ¶

### å·¥ä½œåŸç†
- **Pollingæ¨¡å¼**ï¼šBotå®šæœŸå‘TelegramæœåŠ¡å™¨è¯·æ±‚æ–°æ¶ˆæ¯
- **ç”¨æˆ·ç®¡ç†**ï¼š`telegramPoller`æœåŠ¡ç®¡ç†å¤šä¸ªç”¨æˆ·çš„è½®è¯¢çŠ¶æ€
- **çŠ¶æ€æŒä¹…åŒ–**ï¼šè½®è¯¢çŠ¶æ€å­˜å‚¨åœ¨å†…å­˜ä¸­

### çŠ¶æ€ç®¡ç†
- **å…¨å±€çŠ¶æ€**ï¼šæ‰€æœ‰ç”¨æˆ·çš„è½®è¯¢çŠ¶æ€
- **ç”¨æˆ·åˆ—è¡¨**ï¼šå½“å‰æ´»è·ƒçš„ç”¨æˆ·IDåˆ—è¡¨
- **å¯åŠ¨/åœæ­¢**ï¼šç”¨æˆ·å¯ä»¥éšæ—¶å¯åŠ¨æˆ–åœæ­¢è‡ªå·±çš„è½®è¯¢

## ä»»åŠ¡æ‘˜è¦åŠŸèƒ½

### é…ç½®æ‘˜è¦
é€šè¿‡ç”¨æˆ·èµ„æ–™æ¥å£é…ç½®ä»»åŠ¡æ‘˜è¦ï¼š
- å¯ç”¨/ç¦ç”¨æ‘˜è¦
- è®¾ç½®æ‘˜è¦é¢‘ç‡
- è®¾ç½®æ‘˜è¦æ—¶é—´

### æ‘˜è¦å†…å®¹
- ä»Šæ—¥ä»»åŠ¡
- å³å°†åˆ°æœŸä»»åŠ¡
- ç»Ÿè®¡æ•°æ®

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯
1. **Tokenæ— æ•ˆ**ï¼š
   ```
   {
     "error": "Invalid Telegram bot token format."
   }
   ```

2. **Botä¸å¯è®¿é—®**ï¼š
   ```
   {
     "error": "Invalid bot token or bot not accessible."
   }
   ```

3. **æœªè®¾ç½®Token**ï¼š
   ```
   {
     "error": "Telegram bot token not set."
   }
   ```

## å®‰å…¨æ³¨æ„äº‹é¡¹

1. **Tokenä¿æŠ¤**ï¼š
   - Bot Tokenåº”å¦¥å–„ä¿ç®¡
   - ä¸è¦åœ¨å…¬å¼€æ¸ é“åˆ†äº«Token
   - å¦‚æ³„éœ²ç«‹å³åœ¨BotFatherä¸­æ’¤é”€

2. **Chat IDéªŒè¯**ï¼š
   - ç¡®ä¿Chat IDå±äºå¯ä¿¡ç”¨æˆ·
   - å»ºè®®åœ¨å®‰å…¨ç¯å¢ƒä¸­æµ‹è¯•

3. **è½®è¯¢é™åˆ¶**ï¼š
   - é¿å…åŒæ—¶ä¸ºå¤ªå¤šç”¨æˆ·å¯ç”¨è½®è¯¢
   - æ³¨æ„Telegram APIçš„é€Ÿç‡é™åˆ¶

## ç›¸å…³ç«¯ç‚¹

- **ç”¨æˆ·èµ„æ–™**ï¼š`/api/users/profile` - é…ç½®Bot Token
- **ä»»åŠ¡æ‘˜è¦**ï¼š`/api/users/profile/task-summary/*` - æ‘˜è¦è®¾ç½®
- **æ”¶ä»¶ç®±**ï¼š`/api/inbox/*` - æŸ¥çœ‹Botæ·»åŠ çš„é¡¹ç›®

## æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•ç¯å¢ƒ**ï¼š
   - åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä¼šæ¨¡æ‹ŸBot APIå“åº”
   - ä¸ä¼šå®é™…è°ƒç”¨Telegram API

2. **ç½‘ç»œè¦æ±‚**ï¼š
   - éœ€è¦èƒ½å¤Ÿè®¿é—®TelegramæœåŠ¡å™¨
   - åœ¨æŸäº›åœ°åŒºå¯èƒ½éœ€è¦ä»£ç†

3. **èµ„æºæ¶ˆè€—**ï¼š
   - è½®è¯¢ä¼šæŒç»­æ¶ˆè€—æœåŠ¡å™¨èµ„æº
   - å»ºè®®æŒ‰éœ€å¯åŠ¨å’Œåœæ­¢

4. **Botç”Ÿå‘½å‘¨æœŸ**ï¼š
   - Bot Tokené•¿æœŸæœ‰æ•ˆ
   - å¯ä»¥é‡å¤ä½¿ç”¨
   - æ”¯æŒéšæ—¶æ›´æ–°Token
