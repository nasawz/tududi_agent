# .dowhile() ç‰¹æ€§æ¼”ç¤º - å¯†ç å¼ºåº¦æ£€æµ‹å™¨

è¿™ä¸ªæ¼”ç¤ºå±•ç¤ºäº† Mastra å·¥ä½œæµä¸­ `.dowhile()` ç‰¹æ€§çš„ä½¿ç”¨æ–¹æ³•ï¼Œé€šè¿‡ä¸€ä¸ªå®ç”¨çš„å¯†ç å¼ºåº¦æ£€æµ‹å™¨æ¥è¯´æ˜"è‡³å°‘æ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åæ ¹æ®æ¡ä»¶å†³å®šæ˜¯å¦ç»§ç»­"çš„å¾ªç¯æ¦‚å¿µã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

- `password-strength-workflow.ts` - ä¸»è¦çš„å·¥ä½œæµå®šä¹‰
- `password-strength-example.ts` - ä½¿ç”¨ç¤ºä¾‹å’Œè¯¦ç»†è¯´æ˜
- `README-dowhile-demo.md` - æœ¬æ–‡æ¡£

## ğŸ” å·¥ä½œæµç¨‹

1. **åˆå§‹åŒ–æ­¥éª¤** (`initPasswordStep`)
   - æ¥æ”¶åŸºç¡€å¯†ç è¯æ±‡
   - æ£€æµ‹åˆå§‹å¯†ç å¼ºåº¦
   - è¯„ä¼°å„é¡¹å®‰å…¨è¦æ±‚

2. **æ”¹è¿›æ­¥éª¤** (`improvePasswordStep`) - **å…³é”®çš„å¾ªç¯æ­¥éª¤**
   - è‡³å°‘æ‰§è¡Œä¸€æ¬¡å¯†ç æ”¹è¿›
   - æ ¹æ®ç¼ºå¤±è¦æ±‚æ·»åŠ ç›¸åº”å…ƒç´ 
   - é‡æ–°è¯„ä¼°å¯†ç å¼ºåº¦
   - è®°å½•æ”¹è¿›æªæ–½

3. **å®Œæˆæ­¥éª¤** (`finalizePasswordStep`)
   - æ˜¾ç¤ºæœ€ç»ˆå¯†ç å’Œç»Ÿè®¡ä¿¡æ¯
   - è¯„ä¼°å®‰å…¨ç­‰çº§
   - ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š

## ğŸ”„ .dowhile() ç‰¹æ€§è¯¦è§£

### è¯­æ³•ç»“æ„

æ ¹æ® [Mastra å®˜æ–¹æ–‡æ¡£](https://mastra.ai/reference/workflows/workflow-methods/dowhile)ï¼š

```typescript
.dowhile(step, conditionFunction)
```

### åœ¨æœ¬æ¼”ç¤ºä¸­çš„ä½¿ç”¨

```typescript
.dowhile(
  improvePasswordStep, 
  async ({ inputData: { strengthScore }, iterationCount }) => {
    // æ¡ä»¶ï¼šå¼ºåº¦å°äº4åˆ† ä¸” æ”¹è¿›æ¬¡æ•°å°‘äº5æ¬¡æ—¶ç»§ç»­å¾ªç¯
    return strengthScore < 4 && iterationCount < 5;
  }
)
```

### æ‰§è¡Œé€»è¾‘

1. **é¦–æ¬¡æ‰§è¡Œ**: æ— æ¡ä»¶æ‰§è¡Œ `improvePasswordStep`ï¼ˆè‡³å°‘ä¸€æ¬¡ï¼‰
2. **æ¡ä»¶æ£€æŸ¥**: æ£€æŸ¥ `strengthScore < 4 && iterationCount < 5`
3. **å†³ç­–**:
   - å¦‚æœæ¡ä»¶ä¸º `true`: ç»§ç»­å¾ªç¯ï¼Œå†æ¬¡æ‰§è¡Œ `improvePasswordStep`
   - å¦‚æœæ¡ä»¶ä¸º `false`: åœæ­¢å¾ªç¯ï¼Œç»§ç»­ä¸‹ä¸€æ­¥ (`finalizePasswordStep`)
4. **è®¡æ•°å™¨**: `iterationCount` ä» 1 å¼€å§‹é€’å¢

### å…³é”®ç‰¹ç‚¹

- **è‡³å°‘æ‰§è¡Œä¸€æ¬¡**: ä¸ç®¡æ¡ä»¶å¦‚ä½•ï¼Œæ­¥éª¤è‡³å°‘æ‰§è¡Œä¸€æ¬¡
- **åç½®æ¡ä»¶æ£€æŸ¥**: åœ¨æ­¥éª¤æ‰§è¡Œ**å**æ£€æŸ¥æ¡ä»¶
- **å¾ªç¯æ§åˆ¶**: æ¡ä»¶ä¸º `true` æ—¶ç»§ç»­å¾ªç¯ï¼Œä¸º `false` æ—¶åœæ­¢
- **è¿­ä»£è®¡æ•°**: è‡ªåŠ¨æä¾› `iterationCount` å‚æ•°ï¼Œä» 1 å¼€å§‹
- **çŠ¶æ€ä¼ é€’**: æ¯æ¬¡å¾ªç¯éƒ½ä¼šä¼ é€’æ›´æ–°åçš„çŠ¶æ€æ•°æ®

## ğŸ†š ä¸ .dountil() çš„å¯¹æ¯”

| ç‰¹æ€§ | .dowhile() | .dountil() |
|------|------------|------------|
| **æ‰§è¡Œæ—¶æœº** | è‡³å°‘æ‰§è¡Œä¸€æ¬¡ | è‡³å°‘æ‰§è¡Œä¸€æ¬¡ |
| **æ¡ä»¶é€»è¾‘** | `true` æ—¶ç»§ç»­å¾ªç¯ | `true` æ—¶åœæ­¢å¾ªç¯ |
| **é€‚ç”¨åœºæ™¯** | æ”¹è¿›/ä¼˜åŒ–å¾ªç¯ | ç›®æ ‡è¾¾æˆå¾ªç¯ |
| **æ¡ä»¶è¯­ä¹‰** | "ç»§ç»­æ¡ä»¶" | "åœæ­¢æ¡ä»¶" |
| **ç¤ºä¾‹æ¡ä»¶** | `score < target` | `score >= target` |

## ğŸš€ è¿è¡Œç¤ºä¾‹

### æ–¹æ³•1: ç›´æ¥è¿è¡Œç¤ºä¾‹æ–‡ä»¶

```bash
npx ts-node src/mastra/workflows/password-strength-example.ts
```

### æ–¹æ³•2: åœ¨ä»£ç ä¸­ä½¿ç”¨

```typescript
import { mastra } from '../index';

// é€šè¿‡ mastra å®ä¾‹è·å–å·¥ä½œæµ
const workflow = mastra.getWorkflow('passwordStrengthWorkflow');

// å¯åŠ¨å·¥ä½œæµ
const result = await workflow.execute({ baseWord: 'hello' });

// è·å–ç»“æœ
console.log('å¯†ç ç”Ÿæˆç»“æœ:', result);
```

**æ³¨æ„**: å½“å‰çš„ç¤ºä¾‹æ–‡ä»¶ä½¿ç”¨æ¨¡æ‹Ÿæ‰§è¡Œæ¥æ¼”ç¤ºå·¥ä½œæµé€»è¾‘ï¼Œå› ä¸ºå®Œæ•´çš„ Mastra è¿è¡Œæ—¶ç¯å¢ƒè®¾ç½®è¾ƒä¸ºå¤æ‚ã€‚å®é™…ä½¿ç”¨æ—¶éœ€è¦æŒ‰ç…§ä¸Šè¿°æ–¹å¼é€šè¿‡ `mastra` å®ä¾‹æ¥æ‰§è¡Œå·¥ä½œæµã€‚

## ğŸ“Š ç¤ºä¾‹è¾“å‡º

### æµ‹è¯•å¼±å¯†ç  "hello"

```
ğŸ§ª æµ‹è¯•åŸºç¡€å¯†ç : "hello"
==================================================
ğŸ” å¯†ç å¼ºåº¦æ£€æµ‹å™¨å¯åŠ¨ï¼
ğŸ“ åŸºç¡€å¯†ç : "hello"
ğŸ“Š åˆå§‹å¼ºåº¦è¯„åˆ†: 1/5
ğŸ“‹ è¦æ±‚æ£€æŸ¥: {
  minLength: false,
  hasUppercase: false,
  hasLowercase: true,
  hasNumbers: false,
  hasSpecialChars: false
}

ğŸ”„ ç¬¬ 1 æ¬¡æ”¹è¿›...
ğŸ” å½“å‰å¯†ç : "hello"
âœ¨ æ”¹è¿›æªæ–½: [ 'æ·»åŠ æ•°å­—åç¼€ "2024" ä»¥è¾¾åˆ°æœ€å°é•¿åº¦', 'å°†é¦–å­—æ¯å¤§å†™', 'æ·»åŠ éšæœºæ•°å­— "42"', 'æ·»åŠ ç‰¹æ®Šå­—ç¬¦ "@"' ]
ğŸ” æ”¹è¿›åå¯†ç : "Hello202442@"
ğŸ“Š æ–°å¼ºåº¦è¯„åˆ†: 5/5
ğŸ“‹ è¦æ±‚æ£€æŸ¥: {
  minLength: true,
  hasUppercase: true,
  hasLowercase: true,
  hasNumbers: true,
  hasSpecialChars: true
}
ğŸ¤” æ£€æŸ¥æ˜¯å¦ç»§ç»­æ”¹è¿›: å¼ºåº¦=5/5, æ¬¡æ•°=1, ç»§ç»­=false

ğŸ‰ å¯†ç ç”Ÿæˆå®Œæˆï¼
ğŸ” æœ€ç»ˆå¯†ç : "Hello202442@"
ğŸ”„ æ€»æ”¹è¿›æ¬¡æ•°: 1
ğŸ“Š æœ€ç»ˆå¼ºåº¦: 5/5
ğŸ›¡ï¸ å®‰å…¨ç­‰çº§: ğŸ›¡ï¸ æå¼º - å†›ç”¨çº§åˆ«
âœ… æ˜¯å¦å®‰å…¨: æ˜¯

ğŸ“‹ è¯¦ç»†æ£€æŸ¥ç»“æœ:
  âœ… é•¿åº¦ â‰¥ 8: é€šè¿‡
  âœ… åŒ…å«å¤§å†™å­—æ¯: é€šè¿‡
  âœ… åŒ…å«å°å†™å­—æ¯: é€šè¿‡
  âœ… åŒ…å«æ•°å­—: é€šè¿‡
  âœ… åŒ…å«ç‰¹æ®Šå­—ç¬¦: é€šè¿‡
```

### æµ‹è¯•ä¸­ç­‰å¯†ç  "Password"

```
ğŸ§ª æµ‹è¯•åŸºç¡€å¯†ç : "Password"
==================================================
ğŸ” å¯†ç å¼ºåº¦æ£€æµ‹å™¨å¯åŠ¨ï¼
ğŸ“ åŸºç¡€å¯†ç : "password"
ğŸ“Š åˆå§‹å¼ºåº¦è¯„åˆ†: 2/5
ğŸ“‹ è¦æ±‚æ£€æŸ¥: {
  minLength: true,
  hasUppercase: false,
  hasLowercase: true,
  hasNumbers: false,
  hasSpecialChars: false
}

ğŸ”„ ç¬¬ 1 æ¬¡æ”¹è¿›...
ğŸ” å½“å‰å¯†ç : "password"
âœ¨ æ”¹è¿›æªæ–½: [ 'å°†é¦–å­—æ¯å¤§å†™', 'æ·»åŠ éšæœºæ•°å­— "73"', 'æ·»åŠ ç‰¹æ®Šå­—ç¬¦ "#"' ]
ğŸ” æ”¹è¿›åå¯†ç : "Password73#"
ğŸ“Š æ–°å¼ºåº¦è¯„åˆ†: 5/5
ğŸ¤” æ£€æŸ¥æ˜¯å¦ç»§ç»­æ”¹è¿›: å¼ºåº¦=5/5, æ¬¡æ•°=1, ç»§ç»­=false

ğŸ‰ å¯†ç ç”Ÿæˆå®Œæˆï¼
ğŸ” æœ€ç»ˆå¯†ç : "Password73#"
ğŸ”„ æ€»æ”¹è¿›æ¬¡æ•°: 1
ğŸ“Š æœ€ç»ˆå¼ºåº¦: 5/5
ğŸ›¡ï¸ å®‰å…¨ç­‰çº§: ğŸ›¡ï¸ æå¼º - å†›ç”¨çº§åˆ«
âœ… æ˜¯å¦å®‰å…¨: æ˜¯
```

## ğŸ’¡ é€‚ç”¨åœºæ™¯

`.dowhile()` ç‰¹æ€§ç‰¹åˆ«é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š

1. **æ•°æ®æ”¹è¿›å¾ªç¯**: é€æ­¥ä¼˜åŒ–æ•°æ®è´¨é‡
2. **é‡è¯•æœºåˆ¶**: è‡³å°‘å°è¯•ä¸€æ¬¡ï¼Œå¤±è´¥åé‡è¯•
3. **æ¸è¿›å¼å¤„ç†**: é€æ­¥è¾¾åˆ°ç›®æ ‡æ ‡å‡†
4. **ç”¨æˆ·äº¤äº’**: è‡³å°‘æ‰§è¡Œä¸€æ¬¡æ“ä½œï¼Œç„¶åæ ¹æ®åé¦ˆå†³å®š
5. **æ€§èƒ½ä¼˜åŒ–**: æŒç»­ä¼˜åŒ–ç›´åˆ°æ»¡è¶³æ€§èƒ½è¦æ±‚
6. **æ•°æ®æ¸…æ´—**: åå¤æ¸…æ´—æ•°æ®ç›´åˆ°è¾¾åˆ°è´¨é‡æ ‡å‡†

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

- **ä¿è¯æ‰§è¡Œ**: ç¡®ä¿å…³é”®æ­¥éª¤è‡³å°‘æ‰§è¡Œä¸€æ¬¡
- **çµæ´»æ¡ä»¶**: æ”¯æŒå¤æ‚çš„ç»§ç»­æ¡ä»¶åˆ¤æ–­
- **è‡ªåŠ¨è®¡æ•°**: å†…ç½®è¿­ä»£è®¡æ•°å™¨ï¼Œä¾¿äºæ§åˆ¶å¾ªç¯æ¬¡æ•°
- **çŠ¶æ€è¿½è¸ª**: å®Œæ•´çš„çŠ¶æ€ä¼ é€’å’Œæ›´æ–°æœºåˆ¶
- **è°ƒè¯•å‹å¥½**: æ¸…æ™°çš„æ‰§è¡Œæµç¨‹å’ŒçŠ¶æ€è¾“å‡º

## ğŸ”§ æœ€ä½³å®è·µ

1. **è®¾ç½®æœ€å¤§è¿­ä»£æ¬¡æ•°**: é¿å…æ— é™å¾ªç¯
   ```typescript
   async ({ inputData, iterationCount }) => {
     return condition && iterationCount < maxIterations;
   }
   ```

2. **æ˜ç¡®ç»§ç»­æ¡ä»¶**: ä½¿ç”¨æ¸…æ™°çš„å¸ƒå°”é€»è¾‘
   ```typescript
   async ({ inputData: { score, isValid } }) => {
     return score < targetScore || !isValid;
   }
   ```

3. **è®°å½•æ”¹è¿›è¿‡ç¨‹**: åœ¨æ¯æ¬¡è¿­ä»£ä¸­è®°å½•å˜åŒ–
   ```typescript
   return {
     ...inputData,
     improvements: [...previousImprovements, newImprovement],
     iterationCount: iterationCount + 1
   };
   ```

4. **æä¾›è¿›åº¦åé¦ˆ**: è®©ç”¨æˆ·äº†è§£å¤„ç†è¿›åº¦
   ```typescript
   console.log(`ğŸ”„ ç¬¬ ${iterationCount} æ¬¡æ”¹è¿›ï¼Œå½“å‰è¿›åº¦: ${progress}%`);
   ```

## ğŸ”— ç›¸å…³èµ„æº

- [Mastra .dowhile() å®˜æ–¹æ–‡æ¡£](https://mastra.ai/reference/workflows/workflow-methods/dowhile)
- [.dountil() ç‰¹æ€§æ¼”ç¤º](./README-dountil-demo.md)
- [å¹¶è¡Œå¤„ç†æ¼”ç¤º](./README-parallel-demo.md)
