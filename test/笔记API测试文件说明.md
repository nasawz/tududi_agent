# 笔记API测试文件说明

本文档说明如何使用 Tududi 笔记API的测试文件。

## 📁 测试文件列表

### 1. test-notes-list.js
**功能**: 基础笔记列表测试
**用途**: 测试获取笔记列表的基本功能
```bash
node test/test-notes-list.js
```

**测试内容**:
- 获取所有笔记
- 验证笔记数据格式
- 检查必要字段

**输出**: 笔记列表详细信息

---

### 2. test-notes-query.js
**功能**: 多种查询场景测试
**用途**: 测试不同的查询参数和排序方式
```bash
node test/test-notes-query.js
```

**测试场景**:
- 基本查询（默认排序）
- 按标题降序排序
- 按创建时间降序排序
- 按更新时间升序排序
- 按标签筛选

**输出**: 5个查询场景的对比结果

---

### 3. test-notes-readonly.js ⭐ **推荐**
**功能**: 只读操作测试
**用途**: 避免数据库锁定的综合测试
```bash
node test/test-notes-readonly.js
```

**测试内容**:
- 所有GET请求
- 多种排序方式
- 标签筛选
- 404错误处理

**特点**:
- ✅ 避免写入操作
- ✅ 测试速度快
- ✅ 适合在数据库锁定时使用

**输出**: 6个测试场景的完整报告

---

### 4. test-notes-detail.js
**功能**: 笔记详情测试
**用途**: 获取单条笔记的完整信息
```bash
node test/test-notes-detail.js
```

**测试内容**:
- 获取笔记详情
- 验证Markdown支持
- 显示笔记内容预览
- 检查标签和项目关联

**输出**: 每个笔记的完整详细信息

---

### 5. test-notes-crud.js
**功能**: 完整CRUD操作测试
**用途**: 测试创建、读取、更新、删除笔记
```bash
node test/test-notes-crud.js
```

**测试流程**:
1. 创建新笔记
2. 获取笔记详情
3. 更新笔记内容
4. 删除笔记
5. 验证删除结果

**⚠️ 注意**: 此测试可能遇到数据库锁定问题（SQLITE_BUSY）
**如果遇到锁定**: 使用 test-notes-readonly.js 替代

---

## 🚀 快速开始

### 最简单的测试方式
```bash
# 推荐：只读测试（快速且稳定）
node test/test-notes-readonly.js
```

### 获取笔记详情
```bash
# 查看现有笔记的详细信息
node test/test-notes-detail.js
```

### 基础列表测试
```bash
# 查看笔记列表
node test/test-notes-list.js
```

### 完整CRUD测试
```bash
# 测试所有操作（如果遇到锁定问题，请重试）
node test/test-notes-crud.js
```

---

## 📋 测试结果查看

所有测试脚本都会在控制台输出详细结果，包括：
- ✅ 成功状态
- ❌ 错误信息
- 📊 数据统计
- 📝 详细信息

**示例输出**:
```
========================================
测试：获取笔记列表 API
========================================

✓ 请求成功!
状态码: 200

=== 笔记列表 ===
总计 2 条笔记

--- 笔记 1 ---
UID: ujacu59hm7ugkhe
标题: 测试笔记 - API功能验证
...

========================================
✓ 测试通过
========================================
```

---

## 🔧 常见问题

### Q: 测试时出现 "SQLITE_BUSY: database is locked" 错误？
**A**: 这是SQLite数据库锁定问题。解决方案：
1. 等待一段时间再重试
2. 使用只读测试：`node test/test-notes-readonly.js`
3. 重启测试环境

### Q: 笔记列表显示为空？
**A**: 可能的原因：
1. 用户还没有创建任何笔记
2. 认证Cookie失效
3. API端点错误

### Q: 如何测试带标签的笔记？
**A**: 目前笔记没有标签。需要先创建带标签的笔记，或修改测试脚本添加标签筛选。

### Q: 测试失败怎么办？
**A**:
1. 检查网络连接
2. 验证Cookie是否有效
3. 检查服务器状态
4. 查看错误日志信息

---

## 📊 当前测试数据

**已发现的笔记**:
- `ujacu59hm7ugkhe` - 测试笔记 - API功能验证
- `d89m1ztq5gyrd9j` - 测试笔记 - API功能验证

**这些笔记包含**:
- 完整的Markdown格式
- 多种语法测试（标题、列表、粗体、斜体、代码块、链接）
- 创建时间：2025-11-05

---

## 📚 相关文档

- **API文档**: `/Users/wangzhe/work/server/tududi_agent/doc/api/notes.md`
- **测试报告**: `/Users/wangzhe/work/server/tududi_agent/笔记API测试报告.md`
- **接口清单**: `/Users/wangzhe/work/server/tududi_agent/当前用户状态相关接口清单.md`

---

## 🎯 下一步建议

1. **重新测试CRUD**: 等待数据库锁定问题解决后，重新运行 `test-notes-crud.js`
2. **测试其他API**: 参考 `当前用户状态相关接口清单.md` 测试其他接口
3. **创建项目**: 测试笔记与项目的关联功能
4. **测试标签管理**: 创建、更新、删除标签
5. **测试搜索**: 使用 `/api/search` 搜索笔记

---

**最后更新**: 2025-11-05
**版本**: v1.0
